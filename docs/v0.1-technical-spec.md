# Version 0.1 - Complete Technical Specification Document

## 🎯 Project Overview

**Project Name:** Lily Cafe POS System  
**Client:** Lily Cafe by Mary's Kitchen  
**Version:** 0.1 (MVP)  
**Target Delivery:** 2-3 weeks  
**Deployment:** Local network (cafe laptop + broadband)  

---

## 📱 User Roles & Access

### 1. Waiter/Staff (No Login Required)
**Device:** Mobile phone  
**Primary Functions:**
- View table status (active/empty)
- Take new orders
- Add items to existing orders
- View all active orders (read-only)

### 2. Admin/Owner (Login Required)
**Device:** Desktop computer at reception (+ mobile responsive)  
**Primary Functions:**
- All waiter functions
- Generate bills and collect payments
- Manage menu items
- Manage categories
- View order history
- Edit/cancel orders
- View business reports (basic)

**Login Credentials:**
- Username: `admin`
- Password: `changeme123` (communicated during handover)
- Token expiry: Configurable via env (default: 24 hours)

---

## 🔄 Core User Flows

### Flow 1: Waiter Takes New Order (Mobile)

```
1. Open app → Lands on Table Grid
2. View tables:
   - Empty tables: Gray, "Table X"
   - Active tables: Highlighted, "Table X"
3. Tap empty table (e.g., Table 5)
4. See menu (scrolling page with category sections)
5. Add items using +/- buttons
6. Items accumulate in floating cart button (shows count & total)
7. Tap floating cart button → Drawer slides up
8. Review order:
   - Edit quantities (+/-)
   - Remove items (trash icon)
   - See subtotal, GST, total
9. Tap "Save Order"
10. Toast: "Order saved for Table 5!"
11. Return to table grid automatically
```

**Edge Cases:**
- If WiFi down: Show error, keep cart, allow retry
- If item unavailable: Shows greyed out "Out of Stock"

---

### Flow 2: Waiter Adds to Existing Order (Mobile)

```
1. Table grid shows Table 5 highlighted (has active order)
2. Tap Table 5
3. See menu with current order in floating button
4. Tap floating button → Drawer shows existing items
5. Close drawer, add more items from menu
6. Tap floating button again → See updated order
7. Tap "Save Order"
8. Toast: "Order updated for Table 5!"
9. Return to table grid
```

---

### Flow 3: Waiter Views Active Orders (Mobile)

```
1. Bottom nav: Tap "Orders"
2. See list of all active orders (cards):
   ┌─────────────────────────────────┐
   │ Table 5               ₹236      │
   │ 3 items | 2:30 PM               │
   │ [View Details]                  │
   └─────────────────────────────────┘
3. Tap "View Details" → Modal shows:
   - Items list with quantities
   - Subtotal, GST, Total
   - [Close] button only
4. Close modal
5. Bottom nav: Tap "Tables" to return to table grid
```

---

### Flow 4: Reception Generates Bill & Collects Payment (Desktop)

```
1. Admin logged in
2. Sidebar: Navigate to "Active Orders"
3. See active orders (cards layout)
4. Customer from Table 5 comes to pay
5. Click [Generate Bill] on Table 5 card
6. Modal opens:
   ┌─────────────────────────────────────┐
   │ Payment for Table 5                 │
   │ Total: ₹236                         │
   │                                     │
   │ Payments Added:                     │
   │ (empty initially)                   │
   │                                     │
   │ Amount Remaining: ₹236              │
   │                                     │
   │ [+ Add Payment Method]              │
   └─────────────────────────────────────┘
7. Click [+ Add Payment Method]
8. Dropdown shows: UPI (default), Cash, Card
9. Enter amount: ₹236
10. Click [Add]
11. Payment appears in list:
    • UPI: ₹236 [×]
    Amount Remaining: ₹0
12. [Print Receipt] button appears (enabled when remaining = 0)
13. Click [Print Receipt]
14. Receipt sent to thermal printer (80mm)
15. Order marked as "Paid"
16. Card removed from Active Orders
17. Success toast: "Payment completed for Table 5"
```

**Split Payment Example:**
```
Total: ₹500
1. Add Payment: UPI ₹300 → Remaining: ₹200
2. Add Payment: Cash ₹200 → Remaining: ₹0
3. [Print Receipt] enabled
```

---

### Flow 5: Admin Manages Menu (Desktop/Mobile)

#### Adding Menu Item
```
1. Sidebar: Navigate to "Menu Management"
2. See table of menu items
3. Click [Add New Item] button
4. Modal opens with form:
   - Name: [required]
   - Description: [optional, textarea]
   - Price: [required, integer only, ₹]
   - Category: [Dropdown with + Create New option]
   - Available: [Checkbox, checked by default]
5. If creating new category:
   - Select "+ Create New Category"
   - Popup: "Category Name: [____]"
   - Enter name, click [Create]
   - New category appears in dropdown, selected
6. Fill form, click [Save]
7. Modal closes
8. Item appears in table
9. Success toast: "Item added successfully"
```

#### Editing Menu Item
```
1. In menu table, click edit icon (✏️) on item
2. Modal opens with pre-filled form
3. Edit fields as needed
4. Click [Save]
5. Modal closes
6. Item updated in table
7. Success toast: "Item updated"
```

#### Deleting Menu Item
```
1. Click delete icon (🗑️) on item
2. Confirmation dialog:
   "Remove Masala Dosa from menu?
    This won't delete past orders.
    [Cancel] [Remove]"
3. Click [Remove]
4. Item removed from table (soft delete: is_available = false)
5. Success toast: "Item removed"
6. Item still shows as "Out of Stock" in waiter's menu
```

---

### Flow 6: Admin Edits/Cancels Orders (Desktop)

#### Editing Order
```
1. In Active Orders, find order card
2. Click [Edit] button
3. Opens order editing interface (similar to waiter's cart)
4. Can:
   - Add more items
   - Change quantities
   - Remove items
5. Click [Save Changes]
6. Order updated
7. Success toast: "Order updated"
```

#### Canceling Order
```
1. In Active Orders, find order card
2. Click [Cancel] button (or [×] icon)
3. Confirmation dialog:
   "Cancel order for Table 5 (₹236)?"
   [No] [Yes, Cancel]
4. Click [Yes, Cancel]
5. Order marked as "Canceled" in database
6. Card removed from Active Orders
7. Success toast: "Order canceled"
8. Order does NOT appear in Order History
```

---

### Flow 7: Admin Views Order History (Desktop)

```
1. Sidebar: Navigate to "Order History"
2. By default: Shows today's paid orders
3. See cards with:
   - Order number
   - Table number
   - Date/time
   - Total amount
   - Payment methods used
4. Click [View Details] → Modal shows full order
5. Can filter:
   - Date selector: "Show orders from: [Date Picker]"
   - Defaults to today
6. Click [View Older] → Shows previous days
```

---

## 🗄️ Database Schema

### Table: `menu_items`
```sql
id               INTEGER PRIMARY KEY AUTOINCREMENT
name             TEXT NOT NULL
description      TEXT
price            INTEGER NOT NULL  -- stored in paise (₹80 = 8000)
category         TEXT NOT NULL
is_available     BOOLEAN DEFAULT TRUE
created_at       DATETIME DEFAULT CURRENT_TIMESTAMP
updated_at       DATETIME DEFAULT CURRENT_TIMESTAMP
```

**Notes:**
- Price stored as integer in paise to avoid float precision issues
- `is_available = FALSE` means soft deleted or out of stock
- Categories stored as text (no separate category table for v0.1)

---

### Table: `orders`
```sql
id               INTEGER PRIMARY KEY AUTOINCREMENT
order_number     TEXT UNIQUE NOT NULL  -- Format: ORD-YYYYMMDD-####
table_number     INTEGER NOT NULL
customer_name    TEXT  -- Optional
created_at       DATETIME DEFAULT CURRENT_TIMESTAMP
updated_at       DATETIME DEFAULT CURRENT_TIMESTAMP
subtotal         INTEGER NOT NULL  -- In paise
gst_amount       INTEGER NOT NULL  -- 18% of subtotal, in paise
total_amount     INTEGER NOT NULL  -- subtotal + gst, in paise
status           TEXT NOT NULL  -- 'active', 'paid', 'canceled'
```

**Status Values:**
- `active`: Order saved, not yet paid
- `paid`: Bill generated, payment completed
- `canceled`: Order canceled by admin

**Order Number Format:** `ORD-20241030-0001`
- Date-based, resets daily
- Sequential within the day

---

### Table: `order_items`
```sql
id               INTEGER PRIMARY KEY AUTOINCREMENT
order_id         INTEGER NOT NULL FOREIGN KEY -> orders.id
menu_item_id     INTEGER NOT NULL FOREIGN KEY -> menu_items.id
menu_item_name   TEXT NOT NULL  -- Snapshot of name at order time
quantity         INTEGER NOT NULL
unit_price       INTEGER NOT NULL  -- Price at order time, in paise
subtotal         INTEGER NOT NULL  -- quantity * unit_price, in paise
```

**Notes:**
- Stores `menu_item_name` and `unit_price` as snapshot
- If menu item price changes later, old orders keep old price
- If menu item deleted, order history still shows it

---

### Table: `payments`
```sql
id               INTEGER PRIMARY KEY AUTOINCREMENT
order_id         INTEGER NOT NULL FOREIGN KEY -> orders.id
payment_method   TEXT NOT NULL  -- 'upi', 'cash', 'card'
amount           INTEGER NOT NULL  -- In paise
created_at       DATETIME DEFAULT CURRENT_TIMESTAMP
```

**Payment Methods:**
- `upi`: All UPI apps (GPay, PhonePe, Paytm, etc.)
- `cash`: Cash payment
- `card`: Card payment

**Notes:**
- One order can have multiple payment records (split payments)
- Sum of payments.amount for an order = orders.total_amount

---

### Table: `categories`
```sql
id               INTEGER PRIMARY KEY AUTOINCREMENT
name             TEXT UNIQUE NOT NULL
created_at       DATETIME DEFAULT CURRENT_TIMESTAMP
```

**Notes:**
- Separate table for categories (changed from storing in menu_items)
- Allows admin to manage categories
- Pre-seeded with common categories

---

## 🔌 API Endpoints

### Authentication

#### `POST /api/auth/login`
**Request:**
```json
{
  "username": "admin",
  "password": "changeme123"
}
```

**Response (200):**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "bearer"
}
```

**Response (401):**
```json
{
  "detail": "Invalid credentials"
}
```

---

### Menu Items

#### `GET /api/menu`
**Query Params:**
- `category` (optional): Filter by category
- `available_only` (optional, default: true): Show only available items

**Response (200):**
```json
{
  "items": [
    {
      "id": 1,
      "name": "Masala Dosa",
      "description": "Crispy dosa with potato filling",
      "price": 80,
      "category": "South Indian",
      "is_available": true
    },
    {
      "id": 2,
      "name": "Filter Coffee",
      "description": null,
      "price": 40,
      "category": "Beverages",
      "is_available": false
    }
  ]
}
```

---

#### `POST /api/menu` 🔒 (Requires Auth)
**Request:**
```json
{
  "name": "Masala Dosa",
  "description": "Crispy dosa with potato filling",
  "price": 80,
  "category": "South Indian",
  "is_available": true
}
```

**Response (201):**
```json
{
  "id": 1,
  "name": "Masala Dosa",
  "description": "Crispy dosa with potato filling",
  "price": 80,
  "category": "South Indian",
  "is_available": true,
  "created_at": "2024-10-30T14:30:00",
  "updated_at": "2024-10-30T14:30:00"
}
```

---

#### `PUT /api/menu/{item_id}` 🔒 (Requires Auth)
**Request:**
```json
{
  "name": "Special Masala Dosa",
  "price": 90
}
```

**Response (200):**
```json
{
  "id": 1,
  "name": "Special Masala Dosa",
  "price": 90,
  ...
}
```

---

#### `DELETE /api/menu/{item_id}` 🔒 (Requires Auth)
**Soft delete: Sets is_available = false**

**Response (200):**
```json
{
  "message": "Item removed successfully"
}
```

---

### Categories

#### `GET /api/categories`
**Response (200):**
```json
{
  "categories": [
    {"id": 1, "name": "South Indian"},
    {"id": 2, "name": "Beverages"},
    {"id": 3, "name": "Snacks"}
  ]
}
```

---

#### `POST /api/categories` 🔒 (Requires Auth)
**Request:**
```json
{
  "name": "North Indian"
}
```

**Response (201):**
```json
{
  "id": 4,
  "name": "North Indian",
  "created_at": "2024-10-30T14:30:00"
}
```

---

### Orders

#### `POST /api/orders`
**Create new order or update existing**

**Request (New Order):**
```json
{
  "table_number": 5,
  "customer_name": "Rahul",
  "items": [
    {"menu_item_id": 1, "quantity": 2},
    {"menu_item_id": 3, "quantity": 1}
  ]
}
```

**Request (Update Existing Order):**
```json
{
  "order_id": 10,
  "items": [
    {"menu_item_id": 1, "quantity": 2},
    {"menu_item_id": 3, "quantity": 1},
    {"menu_item_id": 5, "quantity": 1}
  ]
}
```

**Response (201 or 200):**
```json
{
  "id": 10,
  "order_number": "ORD-20241030-0001",
  "table_number": 5,
  "customer_name": "Rahul",
  "status": "active",
  "items": [
    {
      "id": 20,
      "menu_item_id": 1,
      "menu_item_name": "Masala Dosa",
      "quantity": 2,
      "unit_price": 80,
      "subtotal": 160
    },
    {
      "id": 21,
      "menu_item_id": 3,
      "menu_item_name": "Coffee",
      "quantity": 1,
      "unit_price": 40,
      "subtotal": 40
    }
  ],
  "subtotal": 200,
  "gst_amount": 36,
  "total_amount": 236,
  "created_at": "2024-10-30T14:30:00"
}
```

**Logic:**
- If `order_id` provided: Update existing order
- Else if table has active order: Update that order
- Else: Create new order

---

#### `GET /api/orders/active`
**Get all active (unpaid) orders**

**Response (200):**
```json
{
  "orders": [
    {
      "id": 10,
      "order_number": "ORD-20241030-0001",
      "table_number": 5,
      "customer_name": "Rahul",
      "item_count": 3,
      "total_amount": 236,
      "created_at": "2024-10-30T14:30:00"
    }
  ]
}
```

---

#### `GET /api/orders/{order_id}`
**Get single order with full details**

**Response (200):**
```json
{
  "id": 10,
  "order_number": "ORD-20241030-0001",
  "table_number": 5,
  "customer_name": "Rahul",
  "status": "active",
  "items": [
    {
      "menu_item_name": "Masala Dosa",
      "quantity": 2,
      "unit_price": 80,
      "subtotal": 160
    },
    {
      "menu_item_name": "Coffee",
      "quantity": 1,
      "unit_price": 40,
      "subtotal": 40
    }
  ],
  "subtotal": 200,
  "gst_amount": 36,
  "total_amount": 236,
  "created_at": "2024-10-30T14:30:00"
}
```

---

#### `PUT /api/orders/{order_id}` 🔒 (Requires Auth)
**Admin edits order**

**Request:**
```json
{
  "items": [
    {"menu_item_id": 1, "quantity": 3},
    {"menu_item_id": 5, "quantity": 1}
  ]
}
```

**Response (200):**
```json
{
  // Updated order object
}
```

---

#### `DELETE /api/orders/{order_id}` 🔒 (Requires Auth)
**Admin cancels order**

**Response (200):**
```json
{
  "message": "Order canceled successfully"
}
```

**Logic:**
- Sets `status = 'canceled'`
- Does not delete from database

---

### Payments & Billing

#### `POST /api/orders/{order_id}/payments` 🔒 (Requires Auth)
**Add payment(s) to order**

**Request:**
```json
{
  "payments": [
    {"method": "upi", "amount": 200},
    {"method": "cash", "amount": 36}
  ]
}
```

**Response (200):**
```json
{
  "order_id": 10,
  "total_amount": 236,
  "total_paid": 236,
  "payments": [
    {"method": "upi", "amount": 200},
    {"method": "cash", "amount": 36}
  ],
  "status": "paid"
}
```

**Logic:**
- Validates total_paid = order.total_amount
- Creates payment records
- Updates order.status = 'paid'

---

#### `GET /api/orders/{order_id}/receipt`
**Generate and return receipt for printing**

**Response (200):**
- Content-Type: `application/pdf`
- Opens print dialog in browser
- Sends to system default printer

**Receipt Format (80mm thermal):**
```
================================
    Lily Cafe by Mary's Kitchen
  123 Main Street, City
  Phone: +91-9876543210
  GSTIN: 29ABCDE1234F1Z5
================================

Order #: ORD-20241030-0001
Date: 30 Oct 2024, 02:30 PM
Table: 5
Customer: Rahul

--------------------------------
Item          Qty  Price   Amt
--------------------------------
Masala Dosa    2   80.00  160.00
Coffee         1   40.00   40.00
--------------------------------
              Subtotal:  200.00
              GST(18%):   36.00
--------------------------------
         TOTAL:  236.00
================================

Payment Details:
UPI:           200.00
Cash:           36.00

================================
   Thank you! Visit again!
================================
```

---

### Order History

#### `GET /api/orders/history` 🔒 (Requires Auth)
**Get paid orders**

**Query Params:**
- `date` (optional): YYYY-MM-DD format, defaults to today
- `limit` (optional): Default 50
- `skip` (optional): For pagination

**Response (200):**
```json
{
  "orders": [
    {
      "id": 10,
      "order_number": "ORD-20241030-0001",
      "table_number": 5,
      "customer_name": "Rahul",
      "total_amount": 236,
      "payment_methods": ["upi", "cash"],
      "created_at": "2024-10-30T14:30:00"
    }
  ],
  "total": 1,
  "date": "2024-10-30"
}
```

---

### Configuration

#### `GET /api/config`
**Get app configuration (for frontend)**

**Response (200):**
```json
{
  "restaurant_name": "Lily Cafe by Mary's Kitchen",
  "max_tables": 15,
  "gst_rate": 18
}
```

---

## 🎨 Frontend Design Specs

### Color Palette (Coffee Theme)
```css
/* Primary Colors */
--coffee-brown: #6F4E37;
--dark-brown: #4A3728;
--light-brown: #A0826D;

/* Secondary Colors */
--cream: #F5E6D3;
--off-white: #FAF8F5;
--lily-green: #8B9D83;

/* Accent Colors */
--success: #4CAF50;
--error: #F44336;
--warning: #FF9800;

/* Neutral Colors */
--text-dark: #2C2420;
--text-light: #6B5D54;
--border: #D4C4B0;
--background: #FFFCF7;
```

### Typography
```css
/* Font Family */
font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

/* Sizes */
--text-xs: 12px;
--text-sm: 14px;
--text-base: 16px;
--text-lg: 18px;
--text-xl: 20px;
--text-2xl: 24px;
--text-3xl: 30px;

/* Weights */
--font-normal: 400;
--font-medium: 500;
--font-semibold: 600;
--font-bold: 700;
```

### Spacing Scale
```css
--space-1: 4px;
--space-2: 8px;
--space-3: 12px;
--space-4: 16px;
--space-5: 20px;
--space-6: 24px;
--space-8: 32px;
--space-10: 40px;
--space-12: 48px;
```

### Border Radius
```css
--radius-sm: 4px;
--radius-md: 8px;
--radius-lg: 12px;
--radius-xl: 16px;
--radius-full: 9999px;
```

### Shadows
```css
--shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
--shadow-md: 0 4px 6px rgba(0,0,0,0.07);
--shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
--shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
```

---

### Component Specs

#### Table Card (Mobile - Table Grid)
```
Empty Table:
┌─────────────────────┐
│                     │
│      Table 5        │  <- text-2xl, font-semibold
│       Empty         │  <- text-sm, text-light
│                     │
└─────────────────────┘
Size: 150px x 120px
Background: cream
Border: 2px solid border
Border-radius: radius-lg
Text-align: center
```

```
Active Table:
┌─────────────────────┐
│                     │
│      Table 3        │  <- text-2xl, font-semibold
│      Active         │  <- text-sm, lily-green
│                     │
└─────────────────────┘
Size: 150px x 120px
Background: lily-green (20% opacity)
Border: 2px solid lily-green
Border-radius: radius-lg
Text-align: center
Box-shadow: shadow-md
```

---

#### Menu Item Card (Mobile - Order Page)
```
┌────────────────────────────────────────┐
│ Masala Dosa            ₹80            │  <- name (left), price (right)
│ Crispy dosa with potato filling       │  <- description, text-sm
│                                        │
│                        [-]  2  [+]    │  <- quantity controls
└────────────────────────────────────────┘

Padding: space-4
Background: off-white
Border: 1px solid border
Border-radius: radius-md
Margin-bottom: space-3

Out of Stock variant:
- Opacity: 0.5
- Badge: "Out of Stock" (error color)
- Buttons disabled
```

---

#### Floating Cart Button (Mobile)
```
Position: Fixed bottom-right
Bottom: 80px (above bottom nav)
Right: 20px
Z-index: 1000

┌──────────────────┐
│  🛒  3 items     │
│     ₹236         │
└──────────────────┘

Size: 120px x 60px
Background: coffee-brown
Color: cream
Border-radius: radius-xl
Box-shadow: shadow-xl
Font-size: text-sm
Font-weight: font-semibold
```

---

#### Cart Drawer (Mobile)
```
Slides up from bottom
Max-height: 80vh
Background: off-white
Border-radius: radius-xl radius-xl 0 0
Box-shadow: shadow-xl

Header:
┌────────────────────────────────────┐
│ Table 5 Order              [×]     │
└────────────────────────────────────┘
Padding: space-4
Border-bottom: 1px solid border

Item Row:
┌────────────────────────────────────┐
│ Masala Dosa                        │
│ [-] 2 [+]  ₹160              [🗑️] │
└────────────────────────────────────┘

Footer:
┌────────────────────────────────────┐
│ Subtotal:                    ₹200  │
│ GST (18%):                    ₹36  │
│ ────────────────────────────────── │
│ Total:                       ₹236  │
│                                    │
│         [Save Order]               │
└────────────────────────────────────┘

Save Order Button:
- Full width
- Height: 48px
- Background: coffee-brown
- Color: cream
- Border-radius: radius-lg
- Font-weight: font-semibold
```

---

#### Bottom Navigation (Mobile - Waiter)
```
Position: Fixed bottom
Height: 60px
Background: off-white
Border-top: 1px solid border
Box-shadow: shadow-lg (inverted)

┌────────────────────────────────────┐
│   [🏠 Tables]    [📋 Orders]       │
└────────────────────────────────────┘

Each button:
- Width: 50%
- Icon + Label
- Active state: coffee-brown background, cream text
- Inactive: text-light
```

---

#### Sidebar Navigation (Desktop - Admin)
```
Width: 240px
Background: dark-brown
Color: cream
Height: 100vh
Position: Fixed left

Logo Section:
┌────────────────────────┐
│   [Lily Cafe Logo]     │
│   Lily Cafe            │
└────────────────────────┘
Height: 80px
Padding: space-6

Nav Items:
┌────────────────────────┐
│ 📊 Active Orders       │
│ 📜 Order History       │
│ 📋 Menu Management     │
│                        │
│ ────────────────────── │
│                        │
│ 🚪 Logout              │
└────────────────────────┘

Each item:
- Padding: space-4 space-6
- Hover: light-brown background
- Active: coffee-brown background
- Font-size: text-base
```

---

#### Order Card (Desktop - Active Orders)
```
┌────────────────────────────────────────────┐
│ Table 5                          ₹236      │
│ 3 items | Started: 2:30 PM                 │
│                                            │
│ [Edit] [View Details] [Generate Bill]     │
└────────────────────────────────────────────┘

Width: 100%
Max-width: 600px
Padding: space-5
Background: off-white
Border: 1px solid border
Border-radius: radius-lg
Margin-bottom: space-4
Box-shadow: shadow-sm

Buttons:
- Height: 36px
- Padding: space-2 space-4
- Border-radius: radius-md
- Font-size: text-sm

Edit: light-brown
View Details: cream (outlined)
Generate Bill: lily-green
```

---

#### Payment Modal (Desktop)
```
┌────────────────────────────────────────────┐
│ Payment for Table 5                  [×]   │
│ ──────────────────────────────────────────│
│                                            │
│ Total: ₹236                                │
│                                            │
│ Payments Added:                            │
│ • UPI: ₹200                          [×]   │
│                                            │
│ Amount Remaining: ₹36                      │
│                                            │
│ [+ Add Payment Method]                     │
│                                            │
│                                            │
│            [Print Receipt]                 │
│                (enabled when remaining=0)  │
└────────────────────────────────────────────┘

Width: 500px
Padding: space-6
Background: off-white
Border-radius: radius-xl
Box-shadow: shadow-xl

Print Receipt Button:
- Full width
- Height: 48px
- Background: lily-green
- Disabled state: opacity 0.5
```

---

## 🔧 Technical Implementation Details

### Frontend Stack
```
- React 18+
- TypeScript
- Vite (build tool)
- React Router DOM (routing)
- @tanstack/react-query (data fetching)
- Axios (HTTP client)
- Tailwind CSS (styling)
- React Hot Toast (notifications)
```

### Backend Stack
```
- Python 3.11+
- FastAPI (web framework)
- SQLAlchemy 2.0 (ORM)
- SQLite (database)
- Pydantic (validation)
- python-jose (JWT)
- passlib (password hashing)
- reportlab (PDF generation)
- uvicorn (ASGI server)
```

---

### Environment Variables (.env)

```bash
# App Configuration
SECRET_KEY=your-secret-key-change-in-production
TOKEN_EXPIRY_HOURS=24
MAX_TABLES=15
GST_RATE=18

# Restaurant Details
RESTAURANT_NAME=Lily Cafe by Mary's Kitchen
RESTAURANT_ADDRESS_LINE1=Shop 123, Main Street
RESTAURANT_ADDRESS_LINE2=City, State - 123456
RESTAURANT_PHONE=+91-1234567890
RESTAURANT_EMAIL=info@lilycafe.com
RESTAURANT_GSTIN=29ABCDE1234F1Z5

# Admin Credentials (for v0.1)
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=$2b$12$... (bcrypt hash of changeme123)

# Database
DATABASE_URL=sqlite:///./restaurant.db

# CORS (for development)
CORS_ORIGINS=http://localhost:5173,http://192.168.1.x:5173
```

---

### Project Structure

```
restaurant-pos/
├── backend/
│   ├── __init__.py
│   ├── main.py              # FastAPI app, routes
│   ├── database.py          # Database connection, session
│   ├── models.py            # SQLAlchemy models
│   ├── schemas.py           # Pydantic schemas
│   ├── crud.py              # Database operations
│   ├── auth.py              # JWT auth, password hashing
│   ├── pdf_generator.py    # Receipt PDF generation
│   ├── config.py            # Load .env variables
│   └── seed_data.py         # Sample data script
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   ├── TableGrid.tsx
│   │   │   ├── MenuList.tsx
│   │   │   ├── CartDrawer.tsx
│   │   │   ├── FloatingCartButton.tsx
│   │   │   ├── ActiveOrdersList.tsx
│   │   │   ├── OrderCard.tsx
│   │   │   ├── MenuManagement.tsx
│   │   │   ├── MenuItemForm.tsx
│   │   │   ├── PaymentModal.tsx
│   │   │   ├── OrderHistory.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── BottomNav.tsx
│   │   ├── pages/
│   │   │   ├── OrderPage.tsx          # Waiter - take orders
│   │   │   ├── ActiveOrdersPage.tsx   # Waiter/Admin - view orders
│   │   │   ├── LoginPage.tsx          # Admin login
│   │   │   ├── MenuManagementPage.tsx # Admin - manage menu
│   │   │   └── OrderHistoryPage.tsx   # Admin - view history
│   │   ├── api/
│   │   │   └── client.ts              # Axios instance, API functions
│   │   ├── types/
│   │   │   └── index.ts               # TypeScript interfaces
│   │   ├── hooks/
│   │   │   ├── useAuth.ts
│   │   │   ├── useOrders.ts
│   │   │   └── useMenu.ts
│   │   ├── utils/
│   │   │   ├── formatCurrency.ts
│   │   │   └── formatDateTime.ts
│   │   ├── App.tsx
│   │   ├── main.tsx
│   │   └── index.css
│   ├── public/
│   │   └── lily-logo.svg
│   ├── package.json
│   ├── tsconfig.json
│   ├── vite.config.ts
│   └── tailwind.config.js
│
├── .env
├── .env.example
├── .gitignore
├── pyproject.toml
├── README.md
└── run.sh                    # Startup script
```

---

## 🧪 Testing Checklist

### Backend Tests (Manual with Postman/curl)

**Authentication**
- [ ] Login with correct credentials → Returns token
- [ ] Login with wrong credentials → Returns 401
- [ ] Protected endpoint without token → Returns 401
- [ ] Protected endpoint with expired token → Returns 401

**Menu Items**
- [ ] Get all menu items → Returns list
- [ ] Get available items only → Filters correctly
- [ ] Get items by category → Filters correctly
- [ ] Create menu item (auth) → Creates successfully
- [ ] Create item with missing fields → Returns 422
- [ ] Update menu item (auth) → Updates successfully
- [ ] Delete menu item (auth) → Soft deletes (is_available=false)
- [ ] Deleted item shows as "Out of Stock" in menu

**Categories**
- [ ] Get all categories → Returns list
- [ ] Create new category (auth) → Creates successfully
- [ ] Duplicate category name → Returns error

**Orders**
- [ ] Create new order → Creates with correct totals
- [ ] GST calculation (18%) → Accurate
- [ ] Order number generation → Unique, correct format
- [ ] Add to existing order → Updates correctly
- [ ] Two orders on same table → Not allowed (returns existing)
- [ ] Get active orders → Returns only active status
- [ ] Get order by ID → Returns full details
- [ ] Update order (auth) → Updates items correctly
- [ ] Cancel order (auth) → Marks as canceled

**Payments**
- [ ] Add single payment → Creates payment record
- [ ] Add split payments → Multiple records created
- [ ] Payment total matches order total → Success
- [ ] Payment total doesn't match → Returns error
- [ ] Order status changes to 'paid' → Correct

**Receipts**
- [ ] Generate receipt PDF → Returns valid PDF
- [ ] Receipt contains all required info → Verified
- [ ] GST details correct → Verified
- [ ] Payment methods shown → Verified

---

### Frontend Tests (Manual Browser Testing)

**Mobile (Waiter Flow)**
- [ ] Table grid loads → Shows all tables
- [ ] Empty vs active tables → Visual difference clear
- [ ] Tap empty table → Loads menu
- [ ] Tap active table → Loads menu with existing order
- [ ] Menu scrolls smoothly → Categories visible
- [ ] Out of stock items → Greyed out correctly
- [ ] Add items with +/- → Quantity updates
- [ ] Floating button shows count → Accurate
- [ ] Tap floating button → Drawer opens
- [ ] Edit quantities in drawer → Updates totals
- [ ] Remove item from drawer → Removed
- [ ] Save order → Success toast, returns to tables
- [ ] WiFi off + save → Error shown, cart intact
- [ ] Bottom nav works → Switches between Tables/Orders
- [ ] View active orders → Read-only, shows all
- [ ] View order details modal → Shows items

**Desktop (Admin Flow)**
- [ ] Login page → Correct credentials work
- [ ] Login → Wrong credentials show error
- [ ] Sidebar navigation → All links work
- [ ] Active orders load → Shows cards
- [ ] Edit order → Can modify items
- [ ] Cancel order → Confirmation, then cancels
- [ ] Generate bill → Payment modal opens
- [ ] Add single payment → Works
- [ ] Add split payments → Multiple payments work
- [ ] Print receipt → Triggers print (check printer)
- [ ] Order moves to history after payment
- [ ] Menu management loads → Shows table
- [ ] Add menu item → Modal opens, saves
- [ ] Add new category on-the-fly → Works
- [ ] Edit menu item → Pre-fills, updates
- [ ] Delete menu item → Confirms, soft deletes
- [ ] Order history → Shows today's orders
- [ ] Change date → Shows older orders
- [ ] View order details → Modal shows full info

**Responsive Design**
- [ ] Mobile (375px) → All elements fit
- [ ] Tablet (768px) → Layout adjusts
- [ ] Desktop (1024px+) → Sidebar + content
- [ ] Admin on mobile → Hamburger menu works

**Cross-browser**
- [ ] Chrome → Works
- [ ] Firefox → Works
- [ ] Safari → Works
- [ ] Mobile Safari → Works
- [ ] Mobile Chrome → Works

---

## 📦 Deployment Steps

### 1. Prepare Backend
```bash
# Install uv (if not already installed)
pip install uv
# OR on Unix: curl -LsSf https://astral.sh/uv/install.sh | sh

# Install Python dependencies
uv sync

# Set up environment variables
cp .env.example .env
# Edit .env with actual values

# Initialize database
uv run python -c "from backend.database import Base, engine; Base.metadata.create_all(bind=engine)"

# Seed sample data (optional for testing)
uv run python backend/seed_data.py

# Test server
uv run uvicorn backend.main:app --reload
# Visit http://localhost:8000/docs for API docs
```

---

### 2. Prepare Frontend
```bash
cd frontend

# Install dependencies
npm install

# Set up environment variables
echo "VITE_API_URL=http://localhost:8000" > .env

# Test dev server
npm run dev
# Visit http://localhost:5173
```

---

### 3. Client Setup (Cafe Laptop)

**Prerequisites:**
- Windows 10/11 or Ubuntu 20.04+
- 8GB RAM minimum
- 50GB free disk space
- Stable broadband connection
- Thermal printer (80mm) connected and set as default

**Installation Steps:**

1. **Install Python 3.11+**
   - Windows: Download from python.org
   - Ubuntu: `sudo apt install python3.11`

2. **Install Node.js 18+**
   - Download from nodejs.org

3. **Copy Project Files**
   ```bash
   # Option A: Git clone (if they have git)
   git clone <repository-url>
   
   # Option B: Copy zip file, extract
   ```

4. **Backend Setup**
   ```bash
   cd restaurant-pos
   
   # Install uv (if not already installed)
   pip install uv
   # OR on Unix: curl -LsSf https://astral.sh/uv/install.sh | sh
   
   # Install dependencies (creates .venv automatically)
   uv sync
   
   # Edit .env with cafe's details
   nano .env  # or notepad .env
   
   # Create database
   uv run python -c "from backend.database import Base, engine; Base.metadata.create_all(bind=engine)"
   
   # Add real menu items
   uv run python backend/seed_data.py  # Or add manually via UI
   ```

5. **Frontend Setup**
   ```bash
   cd frontend
   npm install
   
   # Update .env with laptop's IP
   echo "VITE_API_URL=http://192.168.1.X:8000" > .env
   ```

6. **Start Services**
   ```bash
   # Terminal 1 - Backend
   cd restaurant-pos
   uv run uvicorn backend.main:app --host 0.0.0.0 --port 8000
   
   # Terminal 2 - Frontend
   cd restaurant-pos/frontend
   npm run dev -- --host 0.0.0.0
   ```

7. **Access from Phones**
   - Find laptop IP: `ipconfig` (Windows) or `ifconfig` (Ubuntu)
   - On phones, open browser: `http://192.168.1.X:5173`
   - Bookmark this URL for quick access

---

### 4. Auto-Start Script (Optional)

**Create `start.sh` (Ubuntu) or `start.bat` (Windows):**

```bash
#!/bin/bash
# start.sh

# Start backend
cd /path/to/restaurant-pos
uv run uvicorn backend.main:app --host 0.0.0.0 --port 8000 &

# Start frontend
cd frontend
npm run dev -- --host 0.0.0.0 &

echo "Restaurant POS started!"
echo "Access at: http://$(hostname -I | awk '{print $1}'):5173"
```

**Make executable:**
```bash
chmod +x start.sh
```

**Run on startup:**
```bash
# Add to crontab
@reboot /path/to/restaurant-pos/start.sh
```

---

## 🔒 Security Considerations

### v0.1 Security Measures
1. **Password Hashing:** Bcrypt with salt
2. **JWT Tokens:** HS256 signing, expiry validation
3. **Input Validation:** Pydantic models validate all inputs
4. **SQL Injection:** SQLAlchemy ORM prevents SQL injection
5. **CORS:** Restricted to cafe network IPs only
6. **HTTPS:** Not required for local network in v0.1

### Known Limitations (Accept for v0.1)
- Single hardcoded admin user
- No rate limiting
- No audit logging
- No backup automation
- No multi-device session management
- Database file not encrypted
- No HTTPS (local network only)

**Note:** These will be addressed in future versions.

---

## 📊 Sample Data (Seed Script)

```python
# backend/seed_data.py

categories = [
    "South Indian",
    "North Indian",
    "Beverages",
    "Snacks",
    "Desserts"
]

menu_items = [
    # South Indian
    {"name": "Masala Dosa", "price": 80, "category": "South Indian"},
    {"name": "Plain Dosa", "price": 60, "category": "South Indian"},
    {"name": "Idli (2 pcs)", "price": 50, "category": "South Indian"},
    {"name": "Vada (2 pcs)", "price": 40, "category": "South Indian"},
    {"name": "Upma", "price": 50, "category": "South Indian"},
    
    # North Indian
    {"name": "Chole Bhature", "price": 100, "category": "North Indian"},
    {"name": "Aloo Paratha", "price": 70, "category": "North Indian"},
    {"name": "Paneer Paratha", "price": 90, "category": "North Indian"},
    
    # Beverages
    {"name": "Filter Coffee", "price": 40, "category": "Beverages"},
    {"name": "Masala Tea", "price": 20, "category": "Beverages"},
    {"name": "Cold Coffee", "price": 60, "category": "Beverages"},
    {"name": "Lassi", "price": 50, "category": "Beverages"},
    
    # Snacks
    {"name": "Samosa (2 pcs)", "price": 30, "category": "Snacks"},
    {"name": "Vada Pav", "price": 35, "category": "Snacks"},
    {"name": "Pakora", "price": 40, "category": "Snacks"},
    
    # Desserts
    {"name": "Gulab Jamun (2 pcs)", "price": 40, "category": "Desserts"},
    {"name": "Jalebi", "price": 50, "category": "Desserts"},
]
```

---

## 📋 Handover Checklist

### Before Handover
- [ ] All features tested and working
- [ ] Seed data matches cafe's actual menu
- [ ] .env configured with cafe details
- [ ] Printer tested (receipt prints correctly)
- [ ] Network access tested from phones
- [ ] Admin credentials communicated
- [ ] Backup plan explained

### During Handover
- [ ] Demonstrate waiter flow (take order)
- [ ] Demonstrate admin login
- [ ] Demonstrate billing & payment
- [ ] Demonstrate menu management
- [ ] Train 2-3 staff members
- [ ] Answer questions
- [ ] Create quick reference guide (printed)

### After Handover
- [ ] Monitor for first week
- [ ] Collect feedback
- [ ] Fix any critical bugs
- [ ] Plan v0.2 features based on usage

---

## 🚀 Next Steps (v0.2 Planning)

**Features identified but deferred:**
1. Inventory tracking (most requested)
2. Kitchen display system
3. Multiple admin users
4. Better reporting/analytics
5. Backup automation
6. Change admin password in UI
7. Add custom categories management page
8. Split payment UI improvements
9. Table-wise order duration tracking
10. Printer configuration in settings

---

## 📞 Support Information

**Developer Contact:** [Your contact info]  
**Project Repository:** [Git URL if applicable]  
**Documentation:** This spec + README.md  

**For Issues:**
1. Check logs: `backend/logs/` (if logging enabled)
2. Restart services: Re-run start script
3. Database issues: Check `restaurant.db` file permissions
4. Network issues: Check firewall, router settings
5. Printer issues: Verify default printer in OS settings

---

## ✅ Definition of Done

Version 0.1 is **complete and ready for deployment** when:

1. ✅ All user flows work end-to-end
2. ✅ Waiter can take orders on phone without errors
3. ✅ Admin can generate bills and print receipts
4. ✅ Menu management works correctly
5. ✅ GST calculations are accurate
6. ✅ Receipt prints correctly on thermal printer
7. ✅ Works reliably on cafe's WiFi network
8. ✅ Staff trained and comfortable using it
9. ✅ No critical bugs in first 3 days of use
10. ✅ Client feedback collected for v0.2

---

**Document Version:** 1.0  
**Last Updated:** October 30, 2024  
**Status:** Final - Ready for Development

---

🎉 **You're all set to start building Version 0.1!**
